@model  IEnumerable<B2BTecnology.Financeiro.DTO.EquipamentosDTO>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            Equipamentos
        </h1>
        <ol class="breadcrumb">
            <li>
                <a href="/Home">B2B Tecnology</a>
            </li>
            <li class="active">
                <i class="fa fa-table fa-fw"></i> Equipamentos
            </li>
        </ol>
    </div>
</div>


<div class="row">
    <div class="col-lg-12 ">
        <div class="form-group col-md-4">
            <input class="form-control" id="Marca" name="Marca" type="text" value="" placeholder="Marca" />
        </div>
        <div class="form-group col-md-4">
            <input class="form-control" id="Modelo" name="Modelo" type="text" value="" placeholder="Modelo" />
        </div>
        <div class="form-group col-md-3">
            <input class="form-control" id="NumeroSerie" name="NumeroSerie" type="text" value="" placeholder="Nº Série" />
        </div>
        <div class="form-group col-md-1">
            <button class="btn btn-default" id="inserir" type="button"><i class="fa fa-edit"></i></button>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-lg-12 ">
        <div class="form-group col-md-12">
            <div class="table-responsive">
                <table id="tabelaEquipamentos" class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th style="width: 30%">Marca</th>
                            <th style="width: 30%">Modelo</th>
                            <th style="width: 30%">Nº Série</th>
                            <th style="width: 10%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.Count(); i++)
                        {
                            var equipamento = Model.ToList()[i];
                            <tr id="@(string.Format("row-{0}", equipamento.IdEquipamento))">
                                <td><label name="@(string.Format("Equipamentos[{0}].Marca", i))">@equipamento.Marca</label></td>
                                <td><label name="@(string.Format("Equipamentos[{0}].Modelo", i))">@equipamento.Modelo</label></td>
                                <td><label name="@(string.Format("Equipamentos[{0}].NumeroSerie", i))">@equipamento.NumeroSerie</label></td>
                                <td><button class="btn btn-warning" type="button" value=""><i class="fa fa-trash"> Excluir</i></button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@Html.Partial("Partials/_Confirmacao")

<div class="panel-footer">

    <input type="button" id="Salvar" value="Salvar" class="btn btn-default" />

</div>

@section scripts
{
    <script>

        $(function () {

            $("#inserir").click(function () {

                var index = $("#tabelaEquipamentos tbody tr").length;

                var idLinha = "row-" + index;
                var labelMarca = "<label name='Equipamentos[" + index + "].Marca'>" + $("#Marca").val() + "</label>";
                var labelModelo = "<label name='Equipamentos[" + index + "].Modelo'>" + $("#Modelo").val() + "</label>";
                var labelNumeroSerie = "<label name='Equipamentos[" + index + "].NumeroSerie'>" + $("#NumeroSerie").val() + "</label>";

                var linha = '<tr id="' + idLinha + '"><td>' + labelMarca + '</td><td>' + labelModelo + '</td><td>' + labelNumeroSerie + '</td><td><button class="btn btn-warning" type="button" value=""><i class="fa fa-trash"> Excluir</i></button></td></tr>';

                $("#tabelaEquipamentos tbody").append(linha);

                ExcluirEquipamento();
            });

            ExcluirEquipamento();

            $("#deleteModal .modal-footer .btn-success").click(function () {

                geral.ModalConfirmarExluisao();
                
                AjusteNames();

            });

        });

        function AjusteNames() {
            
            $("table tbody tr").each(function (index) {

                $(this).find('td label').each(function () {

                    var name = $(this).attr('name');
                    var propriedade = name.split('.')[1];
                    $(this).attr('name', 'Equipamentos[' + index + '].' + propriedade);

                });

            });

        }

        function ExcluirEquipamento() {
            
            $("table tbody button").click(function () {

                var id = $(this).closest('tr').attr('id');
                var serie = $($(this).closest('tr').find('td')[2]).text();
                geral.ModalExluir('Excluir - Equipamento', id, serie);

            });

        }

    </script>
}
